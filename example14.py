import numpy as np

#Debug me :)

#given an atmospheric temperature profile and surface temperature, lift the parcel dry adibatically
# to find the equilibrium height. If none, then report there is a surface inversion

pressures = np.array([920, 911, 901, 890, 880, 871, 861, 851, 841, 832, 822, 813, 803, 794, 785, 776, 766, 757, 749, 740, 731, 722, 714, 705, 697, 688, 680, 672, 664, 656, 648, 640, 632, 624, 617, 609, 602, 594, 587, 580, 573, 565, 558, 551, 545, 538, 531, 524, 518, 511, 505, 498, 492, 486, 480, 474, 467, 461, 455, 450, 444, 438, 432, 427, 421, 416, 410, 405, 400, 394, 389, 384, 379, 374, 369, 364, 359, 354, 349, 344, 340, 335, 330, 326, 321, 317, 313, 308, 304, 300, 295, 291, 287, 283, 279, 275, 271, 267, 263, 260, 256, 252, 249, 245, 241, 238, 234, 231, 227, 224, 221, 217, 214], dtype=np.float)

heights = np.array([800.0, 900.0, 1000.0, 1100.0, 1200.0, 1300.0, 1400.0, 1500.0, 1600.0, 1700.0, 1800.0, 1900.0, 2000.0, 2100.0, 2200.0, 2300.0, 2400.0, 2500.0, 2600.0, 2700.0, 2800.0, 2900.0, 3000.0, 3100.0, 3200.0, 3300.0, 3400.0, 3500.0, 3600.0, 3700.0, 3800.0, 3900.0, 4000.0, 4100.0, 4200.0, 4300.0, 4400.0, 4500.0, 4600.0, 4700.0, 4800.0, 4900.0, 5000.0, 5100.0, 5200.0, 5300.0, 5400.0, 5500.0, 5600.0, 5700.0, 5800.0, 5900.0, 6000.0, 6100.0, 6200.0, 6300.0, 6400.0, 6500.0, 6600.0, 6700.0, 6800.0, 6900.0, 7000.0, 7100.0, 7200.0, 7300.0, 7400.0, 7500.0, 7600.0, 7700.0, 7800.0, 7900.0, 8000.0, 8100.0, 8200.0, 8300.0, 8400.0, 8500.0, 8600.0, 8700.0, 8800.0, 8900.0, 9000.0, 9100.0, 9200.0, 9300.0, 9400.0, 9500.0, 9600.0, 9700.0, 9800.0, 9900.0, 10000.0, 10100.0, 10200.0, 10300.0, 10400.0, 10500.0, 10600.0, 10700.0, 10800.0, 10900.0, 11000.0, 11100.0, 11200.0, 11300.0, 11400.0, 11500.0, 11600.0, 11700.0, 11800.0, 11900.0, 12000.0])

temps = np.array([30.4, 29.3, 28.2, 27.1, 26.0, 24.9, 23.8, 22.7, 21.6, 20.5, 19.4, 18.3, 17.2, 16.1, 15.0, 13.9, 12.8, 11.7, 10.6, 9.5, 8.4, 7.3, 6.2, 5.1, 4.0, 2.9, 1.8, 0.7, -0.4, -1.5, -2.6, -3.7, -4.8, -5.9, -7.0, -8.1, -9.2, -10.3, -11.4, -12.5, -13.6, -14.7, -15.8, -16.9, -18.0, -19.1, -20.2, -21.3, -22.4, -23.5, -24.6, -25.7, -26.8, -27.9, -29.0, -30.1, -31.2, -32.3, -33.4, -34.5, -35.6, -36.7, -37.8, -38.9, -40.0, -41.1, -42.2, -43.3, -44.4, -45.5, -46.6, -47.7, -48.8, -49.9, -51.0, -52.1, -53.2, -54.3, -55.4, -56.5, -57.6, -58.7, -59.8, -60.9, -62.0, -63.1, -64.2, -65.3, -66.4, -67.5, -68.6, -69.7, -70.8, -71.9, -73.0, -74.1, -75.2, -76.3, -77.4, -78.5, -79.6, -80.7, -81.8, -82.9, -84.0, -85.1, -86.2, -87.3, -88.4, -89.5, -90.6, -91.7, -92.8])

surface = 33.1

#lift parcel adiabatically until we reach equilibrium 
dalr = 9.8 / 1000. # per meter
parcel_temp = surface + 0.

i = 0
while parcel_temp > temps[i]:
    delta_h = heights[i+1] - heights[i]
    parcel_temp -= dalr * (delta_h)

#now let's see if there is a surface inversion or BL depth to use
if i > 0:
    print 'height of equilibrium is', heights[i]
    print 'which is %s AGL.' % (heights[0] - heights[i])
else:
    print 'there is a surface inversion. move on...'
